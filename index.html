<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playlist Transfer: Spotify to YouTube Music</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">
    <div class="container mx-auto p-4 md:p-8 max-w-3xl w-full">
        <div class="bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-10">
            <header class="text-center mb-8">
                <h1 class="text-4xl font-bold text-green-400">Playlist Porter</h1>
                <p class="text-gray-400 mt-2">Transfer your Spotify playlists to YouTube Music seamlessly.</p>
            </header>

            <!-- Error Message Display -->
            <div id="error-container" class="hidden bg-red-900 border border-red-500 text-red-200 px-4 py-3 rounded-lg relative mb-6" role="alert">
                <strong class="font-bold">Error: </strong>
                <span id="error-message" class="block sm:inline"></span>
            </div>

            <main id="main-content">
                <!-- Step 1: Authentication -->
                <div id="auth-section">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div id="spotify-auth" class="bg-gray-700 p-6 rounded-xl flex flex-col items-center justify-center">
                            <h2 class="text-2xl font-semibold mb-4">Step 1: Connect Spotify</h2>
                            <button id="spotify-login-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 w-full">
                                Login with Spotify
                            </button>
                            <p id="spotify-status" class="mt-4 text-sm text-gray-400">Not connected.</p>
                        </div>
                        <div id="youtube-auth" class="bg-gray-700 p-6 rounded-xl flex flex-col items-center justify-center">
                            <h2 class="text-2xl font-semibold mb-4">Step 2: Connect YouTube</h2>
                            <button id="youtube-login-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 w-full" disabled>
                                Login with YouTube
                            </button>
                             <p id="youtube-status" class="mt-4 text-sm text-gray-400">Not connected.</p>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Select Playlist -->
                <div id="playlist-selection-section" class="hidden mt-8">
                    <h2 class="text-2xl font-semibold mb-4 text-center">Step 3: Choose a Playlist to Transfer</h2>
                    <div id="playlist-list" class="max-h-96 overflow-y-auto bg-gray-700 p-4 rounded-xl space-y-3">
                        <!-- Playlists will be dynamically inserted here -->
                    </div>
                </div>

                <!-- Step 3: Transfer Progress -->
                <div id="transfer-progress-section" class="hidden mt-8 text-center">
                    <h2 class="text-2xl font-semibold mb-2">Transferring...</h2>
                    <p id="transfer-playlist-name" class="text-gray-400 mb-4"></p>
                    <div class="w-full bg-gray-700 rounded-full h-4 mb-4">
                        <div id="progress-bar" class="bg-blue-500 h-4 rounded-full" style="width: 0%"></div>
                    </div>
                    <p id="progress-text" class="text-sm text-gray-300">Initializing...</p>
                    <div id="transfer-log" class="mt-4 text-left bg-gray-800 p-4 rounded-lg max-h-60 overflow-y-auto text-sm">
                        <!-- Log messages will appear here -->
                    </div>
                </div>
                 <!-- Step 4: Transfer Complete -->
                <div id="transfer-complete-section" class="hidden mt-8 text-center">
                    <h2 class="text-2xl font-semibold mb-2 text-green-400">Transfer Complete!</h2>
                    <p id="complete-message" class="text-gray-300 mb-4"></p>
                    <a id="youtube-playlist-link" href="#" target="_blank" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg inline-block">View on YouTube Music</a>
                    <button id="start-over-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg ml-4">Start New Transfer</button>
                </div>
            </main>
        </div>
        <footer class="text-center mt-6 text-gray-500 text-sm">
            <p>Disclaimer: This tool is not affiliated with Spotify or YouTube.</p>
        </footer>
    </div>

    <script>
        // --- CONFIGURATION ---
        // IMPORTANT: You must get your own Client IDs from Spotify and Google.
        const SPOTIFY_CLIENT_ID = 'f6bfdf6d6a834929a3dfc757836f749b'; 
        const YOUTUBE_API_KEY = 'AIzaSyBNQ1BKWBMNmjJlazFoX_EQmjlRPzCBVzQ';
        const YOUTUBE_CLIENT_ID = 'Y445292307504-moli317tov55j704jlabrb9psvhc7ep5.apps.googleusercontent.com';

        const REDIRECT_URI = window.location.origin + window.location.pathname;

        // --- DOM ELEMENTS ---
        const spotifyLoginBtn = document.getElementById('spotify-login-btn');
        const youtubeLoginBtn = document.getElementById('youtube-login-btn');
        const spotifyStatus = document.getElementById('spotify-status');
        const youtubeStatus = document.getElementById('youtube-status');
        const authSection = document.getElementById('auth-section');
        const playlistSelectionSection = document.getElementById('playlist-selection-section');
        const playlistList = document.getElementById('playlist-list');
        const transferProgressSection = document.getElementById('transfer-progress-section');
        const transferCompleteSection = document.getElementById('transfer-complete-section');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const transferLog = document.getElementById('transfer-log');
        const startOverBtn = document.getElementById('start-over-btn');
        const transferPlaylistName = document.getElementById('transfer-playlist-name');
        const completeMessage = document.getElementById('complete-message');
        const youtubePlaylistLink = document.getElementById('youtube-playlist-link');
        const errorContainer = document.getElementById('error-container');
        const errorMessage = document.getElementById('error-message');

        // --- STATE ---
        let spotifyAccessToken = null;
        let googleAuth = null;

        // --- ERROR HANDLING ---
        function displayError(message) {
            errorMessage.textContent = message;
            errorContainer.classList.remove('hidden');
        }

        function clearError() {
            errorContainer.classList.add('hidden');
        }

        // --- ON PAGE LOAD ---
        window.onload = async () => {
            handleSpotifyRedirect();
            loadGoogleApi();
        };

        // --- AUTHENTICATION ---

        function handleSpotifyRedirect() {
            const params = new URLSearchParams(window.location.hash.substring(1));
            const token = params.get('access_token');
            if (token) {
                spotifyAccessToken = token;
                spotifyStatus.textContent = 'Connected!';
                spotifyStatus.classList.add('text-green-400');
                spotifyLoginBtn.disabled = true;
                youtubeLoginBtn.disabled = false;
                window.history.pushState("", document.title, window.location.pathname + window.location.search);
            }
        }
        
        function loadGoogleApi() {
            const script = document.createElement('script');
            script.src = 'https://apis.google.com/js/api.js';
            script.onload = () => gapi.load('client:auth2', initGoogleClient);
            document.body.appendChild(script);
        }
        
        async function initGoogleClient() {
            try {
                await gapi.client.init({
                    apiKey: YOUTUBE_API_KEY,
                    clientId: YOUTUBE_CLIENT_ID,
                    discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest"],
                    scope: 'https://www.googleapis.com/auth/youtube.force-ssl'
                });
                googleAuth = gapi.auth2.getAuthInstance();
                
                if (googleAuth.isSignedIn.get()) {
                    youtubeStatus.textContent = 'Connected!';
                    youtubeStatus.classList.add('text-green-400');
                    youtubeLoginBtn.disabled = true;
                    if (spotifyAccessToken) {
                        showPlaylistSelection();
                    }
                }
            } catch (error) {
                console.error("Error initializing Google Client:", error);
                // This is the most likely place for the user's error.
                displayError("Could not initialize Google API. Please double-check that your API Key and Client ID are correct in the script, and that your authorized URLs are correctly set in the Google Cloud Console.");
            }
        }

        spotifyLoginBtn.addEventListener('click', () => {
            clearError();
            if (SPOTIFY_CLIENT_ID === 'YOUR_SPOTIFY_CLIENT_ID') {
                displayError('Please set your Spotify Client ID in the script.');
                return;
            }
            const scope = 'playlist-read-private playlist-read-collaborative';
            const authUrl = `https://accounts.spotify.com/authorize?client_id=${SPOTIFY_CLIENT_ID}&response_type=token&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=${encodeURIComponent(scope)}`;
            window.location.href = authUrl;
        });

        youtubeLoginBtn.addEventListener('click', async () => {
            clearError();
             if (YOUTUBE_CLIENT_ID === 'YOUR_YOUTUBE_CLIENT_ID' || YOUTUBE_API_KEY === 'YOUR_YOUTUBE_API_KEY') {
                displayError('Please set your YouTube API Key and Client ID in the script.');
                return;
            }
            try {
                await googleAuth.signIn();
                if (googleAuth.isSignedIn.get()) {
                    youtubeStatus.textContent = 'Connected!';
                    youtubeStatus.classList.add('text-green-400');
                    youtubeLoginBtn.disabled = true;
                    showPlaylistSelection();
                }
            } catch (error) {
                console.error("Error signing in to Google:", error);
                displayError("There was an error signing in with Google. Please try again.");
            }
        });

        // --- UI LOGIC ---

        async function showPlaylistSelection() {
            authSection.classList.add('hidden');
            playlistSelectionSection.classList.remove('hidden');
            playlistList.innerHTML = '<p>Loading playlists...</p>';

            try {
                const playlists = await getSpotifyPlaylists();
                renderPlaylists(playlists);
            } catch (error) {
                console.error("Error fetching Spotify playlists:", error);
                playlistList.innerHTML = '<p class="text-red-400">Could not load playlists. Your Spotify session might have expired. Please refresh and log in again.</p>';
            }
        }

        function renderPlaylists(playlists) {
            if (!playlists || playlists.length === 0) {
                playlistList.innerHTML = '<p>No playlists found.</p>';
                return;
            }
            playlistList.innerHTML = playlists.map(p => `
                <div class="bg-gray-800 p-4 rounded-lg flex items-center justify-between hover:bg-gray-600 transition duration-200">
                    <div class="flex items-center">
                        <img src="${p.images[0]?.url || 'https://placehold.co/60x60/1DB954/FFFFFF?text=S'}" alt="${p.name}" class="w-16 h-16 rounded-md mr-4">
                        <div>
                            <p class="font-bold">${p.name}</p>
                            <p class="text-sm text-gray-400">${p.tracks.total} tracks</p>
                        </div>
                    </div>
                    <button class="transfer-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg" data-playlist-id="${p.id}" data-playlist-name="${p.name}" data-playlist-description="${p.description || ''}">
                        Transfer
                    </button>
                </div>
            `).join('');
            
            document.querySelectorAll('.transfer-btn').forEach(button => {
                button.addEventListener('click', handleTransfer);
            });
        }

        // --- API CALLS ---

        async function getSpotifyPlaylists(url = 'https://api.spotify.com/v1/me/playlists?limit=50') {
            const response = await fetch(url, {
                headers: { 'Authorization': `Bearer ${spotifyAccessToken}` }
            });
            if (!response.ok) throw new Error('Failed to fetch playlists');
            const data = await response.json();
            let playlists = data.items;
            if (data.next) {
                playlists = playlists.concat(await getSpotifyPlaylists(data.next));
            }
            return playlists;
        }
        
        async function getSpotifyPlaylistTracks(playlistId, url = `https://api.spotify.com/v1/playlists/${playlistId}/tracks?limit=100`) {
             const response = await fetch(url, {
                headers: { 'Authorization': `Bearer ${spotifyAccessToken}` }
            });
            if (!response.ok) throw new Error('Failed to fetch tracks');
            const data = await response.json();
            let tracks = data.items.filter(item => item.track).map(item => ({
                name: item.track.name,
                artist: item.track.artists.map(a => a.name).join(', ')
            }));
            if (data.next) {
                tracks = tracks.concat(await getSpotifyPlaylistTracks(playlistId, data.next));
            }
            return tracks;
        }

        async function createYouTubePlaylist(name, description) {
            const response = await gapi.client.youtube.playlists.insert({
                part: 'snippet,status',
                resource: {
                    snippet: {
                        title: name,
                        description: `Playlist transferred from Spotify. Original description: ${description}`
                    },
                    status: {
                        privacyStatus: 'private'
                    }
                }
            });
            return response.result;
        }

        async function searchYouTube(query) {
             const response = await gapi.client.youtube.search.list({
                part: 'snippet',
                q: query,
                type: 'video',
                maxResults: 1
            });
            return response.result.items[0];
        }

        async function addVideoToYouTubePlaylist(playlistId, videoId) {
            const response = await gapi.client.youtube.playlistItems.insert({
                part: 'snippet',
                resource: {
                    snippet: {
                        playlistId: playlistId,
                        resourceId: {
                            kind: 'youtube#video',
                            videoId: videoId
                        }
                    }
                }
            });
            return response.result;
        }

        // --- TRANSFER LOGIC ---

        async function handleTransfer(event) {
            const button = event.currentTarget;
            const playlistId = button.dataset.playlistId;
            const playlistName = button.dataset.playlistName;
            const playlistDescription = button.dataset.playlistDescription;

            // Show progress view
            playlistSelectionSection.classList.add('hidden');
            transferProgressSection.classList.remove('hidden');
            transferPlaylistName.textContent = `Playlist: ${playlistName}`;
            transferLog.innerHTML = '';
            progressBar.style.width = '0%';
            progressText.textContent = 'Initializing...';
            
            let successfulTransfers = 0;
            let failedTransfers = 0;

            try {
                // 1. Get Spotify tracks
                addLog('Fetching tracks from Spotify...');
                const tracks = await getSpotifyPlaylistTracks(playlistId);
                const totalTracks = tracks.length;
                addLog(`Found ${totalTracks} tracks.`);

                // 2. Create YouTube playlist
                addLog(`Creating YouTube playlist "${playlistName}"...`);
                const youtubePlaylist = await createYouTubePlaylist(playlistName, playlistDescription);
                addLog(`YouTube playlist created! ID: ${youtubePlaylist.id}`);

                // 3. Search and add each track
                for (let i = 0; i < totalTracks; i++) {
                    const track = tracks[i];
                    const query = `${track.name} ${track.artist}`;
                    
                    progressText.textContent = `(${i + 1}/${totalTracks}) Searching for: ${query}`;
                    
                    try {
                        const searchResult = await searchYouTube(query);
                        if (searchResult && searchResult.id.videoId) {
                            await addVideoToYouTubePlaylist(youtubePlaylist.id, searchResult.id.videoId);
                            addLog(`✅ Successfully added: ${track.name}`, 'text-green-400');
                            successfulTransfers++;
                        } else {
                            addLog(`❌ Could not find: ${track.name}`, 'text-red-400');
                            failedTransfers++;
                        }
                    } catch (searchError) {
                        addLog(`❌ Error adding ${track.name}: ${searchError.message || 'Unknown error'}`, 'text-red-400');
                        failedTransfers++;
                    }

                    progressBar.style.width = `${((i + 1) / totalTracks) * 100}%`;
                }
                
                // 4. Show complete screen
                showCompleteScreen(youtubePlaylist.id, successfulTransfers, failedTransfers);

            } catch (error) {
                console.error("Transfer failed:", error);
                addLog(`A fatal error occurred: ${error.message}`, 'text-red-500 font-bold');
                progressText.textContent = 'Transfer failed!';
            }
        }
        
        function addLog(message, colorClass = 'text-gray-300') {
            const p = document.createElement('p');
            p.textContent = message;
            p.className = colorClass;
            transferLog.appendChild(p);
            transferLog.scrollTop = transferLog.scrollHeight; // Auto-scroll
        }

        function showCompleteScreen(playlistId, successCount, failCount) {
            transferProgressSection.classList.add('hidden');
            transferCompleteSection.classList.remove('hidden');
            
            completeMessage.textContent = `Successfully transferred ${successCount} tracks. ${failCount} tracks could not be found.`;
            youtubePlaylistLink.href = `https://music.youtube.com/playlist?list=${playlistId}`;
        }
        
        startOverBtn.addEventListener('click', () => {
            transferCompleteSection.classList.add('hidden');
            showPlaylistSelection();
        });

    </script>
</body>
</html>

